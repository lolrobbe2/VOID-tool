@page "/"
@using FoxholeBot.Components
@using System.Net.Http
@using foxhole_void_bot.src.frontend.Pages.Components.Banner
@using System.Net.Http.Json
@using Microsoft.JSInterop
@inject IJSRuntime JS
@inject HttpClient Client


<Banner />

@if (myVideoList.Length > 0)
{
    <VideoCarousel VideoUrls="@myVideoList" />
}


@code {
    private string[] myVideoList = [];
    private bool _loaded = false;
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && !_loaded)
        {
            try
            {
                HttpResponseMessage response = await Client.GetAsync("api/Assets/Carousel");
                response.EnsureSuccessStatusCode();
                myVideoList = await response.Content.ReadFromJsonAsync<string[]>();
                _loaded = true;
                StateHasChanged(); // re-render after data arrives
            }
            catch (Exception ex)
            {
                Console.Error.WriteLine($"Failed to load carousel via JS: {ex.Message}");
                myVideoList = []; // fallback
            }
        }
    }
}
